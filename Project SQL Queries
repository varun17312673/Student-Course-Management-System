-- ===========================================================
--   PROJECT: STUDENT COURSE MANAGEMENT SYSTEM (SCMS)
--   Description: A simple SQL database for managing students,
--   courses, faculty, and enrollments with 25 useful queries.
-- ===========================================================


-- ==========================
-- 1. CREATE TABLES
-- ==========================

CREATE TABLE Students (
    student_id INT PRIMARY KEY,
    name VARCHAR(50),
    email VARCHAR(50),
    age INT,
    department VARCHAR(50)
);

CREATE TABLE Faculty (
    faculty_id INT PRIMARY KEY,
    faculty_name VARCHAR(50),
    experience INT
);

CREATE TABLE Courses (
    course_id INT PRIMARY KEY,
    course_name VARCHAR(50),
    credits INT,
    faculty_id INT,
    FOREIGN KEY (faculty_id) REFERENCES Faculty(faculty_id)
);

CREATE TABLE Enrollments (
    enroll_id INT PRIMARY KEY,
    student_id INT,
    course_id INT,
    enroll_date DATE,
    FOREIGN KEY (student_id) REFERENCES Students(student_id),
    FOREIGN KEY (course_id) REFERENCES Courses(course_id)
);


-- ==========================
-- 2. INSERT SAMPLE DATA
-- ==========================

INSERT INTO Students VALUES
(1,'Aarav','aarav@gmail.com',20,'Computer Science'),
(2,'Riya','riya@gmail.com',21,'IT'),
(3,'Kabir','kabir@gmail.com',22,'EXTC'),
(4,'Sara','sara@gmail.com',20,'Computer Science');

INSERT INTO Faculty VALUES
(1,'Dr. Mehta',12),
(2,'Prof. Rao',7),
(3,'Dr. Nisha',10);

INSERT INTO Courses VALUES
(101,'DBMS',4,1),
(102,'Java Programming',3,2),
(103,'Data Structures',4,1),
(104,'Operating Systems',3,3);

INSERT INTO Enrollments VALUES
(1,1,101,'2023-07-10'),
(2,1,103,'2023-07-15'),
(3,2,102,'2023-07-20'),
(4,3,104,'2023-07-22'),
(5,4,101,'2023-07-25');


-- ==========================
-- 3. 25 SQL QUERIES
-- ==========================


-- 1. Get all students
SELECT * FROM Students;

-- 2. List all courses with credits
SELECT course_name, credits FROM Courses;

-- 3. Show all faculty with experience > 8
SELECT * FROM Faculty WHERE experience > 8;

-- 4. Students sorted by age
SELECT * FROM Students ORDER BY age DESC;

-- 5. Courses with more than 3 credits
SELECT * FROM Courses WHERE credits > 3;

-- 6. Students from Computer Science department
SELECT * FROM Students WHERE department = 'Computer Science';

-- 7. List students with the courses they enrolled in
SELECT s.name, c.course_name
FROM Students s
JOIN Enrollments e ON s.student_id = e.student_id
JOIN Courses c ON e.course_id = c.course_id;

-- 8. Students with faculty who teaches their course
SELECT s.name AS student, c.course_name, f.faculty_name
FROM Students s
JOIN Enrollments e ON s.student_id = e.student_id
JOIN Courses c ON c.course_id = e.course_id
JOIN Faculty f ON f.faculty_id = c.faculty_id;

-- 9. Faculty and the courses they handle
SELECT faculty_name, course_name 
FROM Faculty f
JOIN Courses c ON f.faculty_id = c.faculty_id;

-- 10. Count total students
SELECT COUNT(*) FROM Students;

-- 11. Count number of courses by each faculty
SELECT faculty_id, COUNT(*) AS total_courses 
FROM Courses
GROUP BY faculty_id;

-- 12. Average credits of all courses
SELECT AVG(credits) AS avg_credits FROM Courses;

-- 13. Number of enrollments for each course
SELECT course_id, COUNT(*) AS total_enrolled
FROM Enrollments
GROUP BY course_id;

-- 14. Departments with more than 1 student
SELECT department, COUNT(*) 
FROM Students
GROUP BY department
HAVING COUNT(*) > 1;

-- 15. Find students not enrolled in any course
SELECT * FROM Students 
WHERE student_id NOT IN (SELECT student_id FROM Enrollments);

-- 16. Courses that no student has enrolled in
SELECT * FROM Courses 
WHERE course_id NOT IN (SELECT course_id FROM Enrollments);

-- 17. Most experienced faculty
SELECT * FROM Faculty
ORDER BY experience DESC
LIMIT 1;

-- 18. Students enrolled in DBMS
SELECT s.name
FROM Students s
JOIN Enrollments e ON s.student_id = e.student_id
JOIN Courses c ON c.course_id = e.course_id
WHERE c.course_name = 'DBMS';

-- 19. Total enrollments in July 2023
SELECT COUNT(*) 
FROM Enrollments 
WHERE MONTH(enroll_date) = 7 AND YEAR(enroll_date) = 2023;

-- 20. List students with age between 20 and 22
SELECT * FROM Students WHERE age BETWEEN 20 AND 22;

-- 21. Faculty teaching 3-credit courses
SELECT f.faculty_name
FROM Faculty f
JOIN Courses c ON f.faculty_id = c.faculty_id
WHERE c.credits = 3;

-- 22. Get the student who enrolled in maximum courses
SELECT student_id, COUNT(*) AS total
FROM Enrollments
GROUP BY student_id
ORDER BY total DESC
LIMIT 1;

-- 23. List students with their total credits
SELECT s.name, SUM(c.credits) AS total_credits
FROM Students s
JOIN Enrollments e ON s.student_id = e.student_id
JOIN Courses c ON c.course_id = e.course_id
GROUP BY s.name;

-- 24. Show course name and number of students enrolled
SELECT c.course_name, COUNT(e.student_id) AS total_students
FROM Courses c
LEFT JOIN Enrollments e ON c.course_id = e.course_id
GROUP BY c.course_name;

-- 25. Faculty who teach more than one course
SELECT faculty_id, COUNT(*) AS num_courses
FROM Courses
GROUP BY faculty_id
HAVING COUNT(*) > 1;
